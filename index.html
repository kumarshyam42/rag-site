<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#26314C">
<title>Project 3: qmd Brief ‚Äî Explorer</title>
<style>
  :root {
    --navy: #26314C;
    --navy-light: #334163;
    --navy-dark: #1a2238;
    --teal: #27BDBE;
    --teal-dim: rgba(39, 189, 190, 0.15);
    --teal-mid: rgba(39, 189, 190, 0.4);
    --gold: #FFC20E;
    --gold-dim: rgba(255, 194, 14, 0.15);
    --gold-mid: rgba(255, 194, 14, 0.4);
    --white: #FFFFFF;
    --gray-100: #f0f2f5;
    --gray-200: #d8dce4;
    --gray-300: #a0aec0;
    --gray-400: #718096;
    --gray-500: #4a5568;
    --red: #e53e3e;
    --red-dim: rgba(229, 62, 62, 0.15);
    --green: #38a169;
    --green-dim: rgba(56, 161, 105, 0.15);
    --font-ui: 'Futura', 'Century Gothic', 'Avant Garde', -apple-system, BlinkMacSystemFont, sans-serif;
    --font-mono: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
    --radius: 8px;
    --radius-lg: 12px;
    --safe-bottom: env(safe-area-inset-bottom, 0px);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: var(--font-ui);
    background: var(--navy-dark);
    color: var(--white);
    height: 100vh;
    overflow: hidden;
    display: grid;
    grid-template-columns: 300px 1fr;
    grid-template-rows: auto 1fr;
    gap: 0;
  }

  /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
  header {
    grid-column: 1 / -1;
    background: var(--navy);
    border-bottom: 1px solid rgba(39, 189, 190, 0.2);
    padding: 14px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  header h1 {
    font-size: 16px;
    font-weight: 500;
    letter-spacing: 0.5px;
    color: var(--white);
  }
  header h1 span { color: var(--teal); }

  .header-meta {
    display: flex;
    gap: 16px;
    align-items: center;
    font-size: 12px;
    color: var(--gray-300);
  }

  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.3px;
  }
  .status-badge.blocker { background: var(--red-dim); color: #fc8181; }
  .status-badge.done { background: var(--green-dim); color: #68d391; }
  .status-badge.pending { background: var(--gold-dim); color: var(--gold); }
  .status-badge::before {
    content: '';
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: currentColor;
  }

  /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
  .sidebar {
    background: var(--navy);
    border-right: 1px solid rgba(39, 189, 190, 0.12);
    overflow-y: auto;
    padding: 0;
    display: flex;
    flex-direction: column;
  }

  .sidebar-section {
    padding: 16px 16px 12px;
    border-bottom: 1px solid rgba(39, 189, 190, 0.08);
  }

  .sidebar-section h3 {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    color: var(--gray-400);
    margin-bottom: 10px;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 13px;
    color: var(--gray-300);
    transition: all 0.15s;
    position: relative;
  }
  .nav-item:hover { background: rgba(39, 189, 190, 0.08); color: var(--white); }
  .nav-item.active { background: var(--teal-dim); color: var(--teal); }
  .nav-item .icon { width: 18px; text-align: center; font-size: 14px; flex-shrink: 0; }
  .nav-item .label { flex: 1; text-wrap: pretty; }
  .nav-item .tag {
    font-size: 10px;
    padding: 1px 6px;
    border-radius: 10px;
    font-weight: 500;
  }
  .tag-done { background: var(--green-dim); color: #68d391; }
  .tag-blocker { background: var(--red-dim); color: #fc8181; }
  .tag-pending { background: var(--gold-dim); color: var(--gold); }
  .tag-blocked { background: rgba(160, 174, 192, 0.15); color: var(--gray-400); }

  /* ‚îÄ‚îÄ Presets ‚îÄ‚îÄ */
  .preset-row {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }
  .preset-btn {
    font-family: var(--font-ui);
    font-size: 11px;
    padding: 5px 10px;
    border-radius: 20px;
    border: 1px solid rgba(39, 189, 190, 0.25);
    background: transparent;
    color: var(--teal);
    cursor: pointer;
    transition: all 0.15s;
  }
  .preset-btn:hover { background: var(--teal-dim); }
  .preset-btn.active { background: var(--teal); color: var(--navy); border-color: var(--teal); }

  /* ‚îÄ‚îÄ Main Content ‚îÄ‚îÄ */
  .main {
    overflow-y: auto;
    padding: 24px 32px;
    scroll-behavior: smooth;
  }

  .content-card {
    background: var(--navy);
    border-radius: var(--radius-lg);
    border: 1px solid rgba(39, 189, 190, 0.12);
    padding: 28px 32px;
    margin-bottom: 20px;
    animation: fadeIn 0.2s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .content-card h2 {
    font-size: 20px;
    font-weight: 500;
    color: var(--white);
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .content-card h2 .section-icon { font-size: 22px; }

  .content-card .subtitle {
    font-size: 13px;
    color: var(--gray-400);
    margin-bottom: 20px;
    line-height: 1.5;
    text-wrap: pretty;
  }

  .content-card h3 {
    font-size: 14px;
    font-weight: 500;
    color: var(--teal);
    margin: 20px 0 10px;
    letter-spacing: 0.3px;
  }

  .content-card p, .content-card li {
    font-size: 13.5px;
    line-height: 1.7;
    color: var(--gray-200);
  }

  .content-card ul, .content-card ol {
    padding-left: 20px;
    margin: 8px 0;
  }
  .content-card li { margin-bottom: 4px; }

  .content-card code {
    font-family: var(--font-mono);
    font-size: 12px;
    background: rgba(39, 189, 190, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
    color: var(--teal);
  }

  .content-card pre {
    font-family: var(--font-mono);
    font-size: 12px;
    background: var(--navy-dark);
    border: 1px solid rgba(39, 189, 190, 0.1);
    border-radius: var(--radius);
    padding: 14px 16px;
    overflow-x: auto;
    margin: 10px 0;
    line-height: 1.6;
    color: var(--gray-200);
  }

  /* Tables */
  .data-table {
    width: 100%;
    border-collapse: collapse;
    margin: 12px 0;
    font-size: 13px;
  }
  .data-table th {
    text-align: left;
    padding: 8px 12px;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--gray-400);
    border-bottom: 1px solid rgba(39, 189, 190, 0.15);
    font-weight: 500;
  }
  .data-table td {
    padding: 8px 12px;
    color: var(--gray-200);
    border-bottom: 1px solid rgba(39, 189, 190, 0.06);
  }
  .data-table tr:hover td { background: rgba(39, 189, 190, 0.04); }

  /* Stat cards */
  .stat-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px;
    margin: 16px 0;
  }
  .stat-card {
    background: var(--navy-dark);
    border: 1px solid rgba(39, 189, 190, 0.1);
    border-radius: var(--radius);
    padding: 14px 16px;
    text-align: center;
  }
  .stat-card .value {
    font-size: 26px;
    font-weight: 600;
    color: var(--teal);
    font-variant-numeric: tabular-nums;
  }
  .stat-card .value.gold { color: var(--gold); }
  .stat-card .value.red { color: #fc8181; }
  .stat-card .desc {
    font-size: 11px;
    color: var(--gray-400);
    margin-top: 4px;
    letter-spacing: 0.3px;
  }

  /* Flow diagram */
  .flow-diagram {
    display: flex;
    align-items: center;
    gap: 0;
    margin: 20px 0;
    overflow-x: auto;
    padding: 10px 0;
  }
  .flow-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    min-width: 100px;
    text-align: center;
  }
  .flow-node {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    border: 2px solid;
    transition: transform 0.15s;
  }
  .flow-node:hover { transform: scale(1.1); }
  .flow-node.done { background: var(--green-dim); border-color: var(--green); }
  .flow-node.current { background: var(--gold-dim); border-color: var(--gold); animation: pulse 2s infinite; }
  .flow-node.blocked { background: var(--red-dim); border-color: #fc8181; }
  .flow-node.future { background: rgba(160, 174, 192, 0.08); border-color: var(--gray-400); opacity: 0.5; }
  @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(255, 194, 14, 0.3); } 50% { box-shadow: 0 0 0 8px rgba(255, 194, 14, 0); } }
  .flow-label { font-size: 11px; color: var(--gray-300); max-width: 90px; }
  .flow-arrow { color: var(--gray-400); font-size: 18px; margin: 0 4px; padding-bottom: 20px; }

  /* Architecture option cards */
  .arch-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin: 16px 0;
  }
  .arch-card {
    background: var(--navy-dark);
    border: 2px solid rgba(39, 189, 190, 0.12);
    border-radius: var(--radius);
    padding: 16px;
    cursor: pointer;
    transition: all 0.15s;
  }
  .arch-card:hover { border-color: var(--teal-mid); }
  .arch-card.selected { border-color: var(--teal); background: var(--teal-dim); }
  .arch-card h4 {
    font-size: 14px;
    font-weight: 500;
    color: var(--white);
    margin-bottom: 6px;
  }
  .arch-card p {
    font-size: 12px;
    color: var(--gray-400);
    line-height: 1.5;
  }
  .arch-card .pros, .arch-card .cons {
    font-size: 11px;
    margin-top: 8px;
    line-height: 1.6;
  }
  .arch-card .pros { color: #68d391; }
  .arch-card .cons { color: #fc8181; }

  /* Checklist */
  .checklist-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 6px 0;
    font-size: 13px;
    color: var(--gray-200);
  }
  .checklist-item .check {
    width: 18px;
    height: 18px;
    border-radius: 4px;
    border: 1.5px solid var(--gray-400);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-top: 1px;
    font-size: 11px;
  }
  .checklist-item.done .check { background: var(--green-dim); border-color: var(--green); color: var(--green); }
  .checklist-item.pending .check { border-color: var(--gold); }
  .checklist-item.blocked .check { border-color: #fc8181; }

  /* Timeline */
  .timeline {
    position: relative;
    padding-left: 24px;
    margin: 16px 0;
  }
  .timeline::before {
    content: '';
    position: absolute;
    left: 7px;
    top: 4px;
    bottom: 4px;
    width: 2px;
    background: rgba(39, 189, 190, 0.2);
  }
  .timeline-item {
    position: relative;
    padding: 8px 0 16px;
  }
  .timeline-item::before {
    content: '';
    position: absolute;
    left: -20px;
    top: 12px;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--teal);
    border: 2px solid var(--navy);
  }
  .timeline-item.s1::before { background: var(--green); }
  .timeline-item.s2::before { background: var(--green); }
  .timeline-item.s3::before { background: var(--gold); }
  .timeline-item h4 { font-size: 13px; font-weight: 500; color: var(--white); }
  .timeline-item p { font-size: 12px; color: var(--gray-400); margin-top: 3px; line-height: 1.5; }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: rgba(39, 189, 190, 0.2); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: rgba(39, 189, 190, 0.4); }

  /* ‚îÄ‚îÄ Mobile Tab Bar ‚îÄ‚îÄ */
  .mobile-tab-bar {
    display: none;
  }

  /* ‚îÄ‚îÄ Slide-up Navigation Sheet ‚îÄ‚îÄ */
  .sheet-backdrop {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 90;
    opacity: 0;
    transition: opacity 0.2s ease;
  }
  .sheet-backdrop.visible {
    opacity: 1;
  }

  .nav-sheet {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 100;
    background: var(--navy);
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.32, 0.72, 0, 1);
    max-height: 80vh;
    overflow-y: auto;
    overscroll-behavior: contain;
    padding-bottom: var(--safe-bottom);
  }
  .nav-sheet.open {
    transform: translateY(0);
  }

  .sheet-handle {
    display: flex;
    justify-content: center;
    padding: 10px 0 6px;
    position: sticky;
    top: 0;
    background: var(--navy);
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
    z-index: 1;
  }
  .sheet-handle::after {
    content: '';
    width: 36px;
    height: 4px;
    border-radius: 2px;
    background: var(--gray-400);
  }

  .sheet-section {
    padding: 8px 20px 16px;
  }
  .sheet-section h3 {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    color: var(--gray-400);
    margin-bottom: 8px;
    padding: 0 4px;
  }

  .sheet-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 12px;
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 14px;
    color: var(--gray-300);
    transition: background 0.15s;
    min-height: 44px;
  }
  .sheet-item:active { background: rgba(39, 189, 190, 0.12); }
  .sheet-item.active { background: var(--teal-dim); color: var(--teal); }
  .sheet-item .icon { width: 22px; text-align: center; font-size: 16px; flex-shrink: 0; }
  .sheet-item .label { flex: 1; }
  .sheet-item .tag {
    font-size: 10px;
    padding: 2px 8px;
    border-radius: 10px;
    font-weight: 500;
  }

  .sheet-presets {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    padding: 4px 4px 8px;
  }
  .sheet-presets .preset-btn {
    font-size: 13px;
    padding: 8px 16px;
    min-height: 44px;
    display: flex;
    align-items: center;
  }

  /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
  @media (max-width: 900px) {
    body {
      grid-template-columns: 1fr;
      grid-template-rows: auto 1fr;
      height: 100%;
    }
    html { height: 100%; }
    .sidebar { display: none; }
    .arch-grid { grid-template-columns: 1fr; }

    header {
      padding: 12px 16px;
    }
    header h1 { font-size: 14px; }
    .header-meta { gap: 8px; }
    .header-meta > span:first-child { display: none; }

    .main {
      padding: 16px;
      padding-bottom: 72px;
    }

    .content-card {
      padding: 20px 18px;
      border-radius: var(--radius);
    }
    .content-card h2 { font-size: 18px; }

    .stat-row {
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 8px;
    }
    .stat-card { padding: 10px 8px; }
    .stat-card .value { font-size: 22px; }
    .stat-card .desc { font-size: 10px; }

    .flow-diagram {
      gap: 0;
      padding: 8px 0;
      -webkit-overflow-scrolling: touch;
    }
    .flow-step { min-width: 80px; }
    .flow-node { width: 40px; height: 40px; font-size: 16px; }
    .flow-label { font-size: 10px; max-width: 72px; }
    .flow-arrow { font-size: 14px; margin: 0 2px; padding-bottom: 16px; }

    .data-table { font-size: 12px; }
    .data-table th, .data-table td { padding: 6px 8px; }

    pre { font-size: 11px !important; padding: 10px 12px !important; }

    /* Show mobile tab bar ‚Äî fixed to bottom of screen */
    .mobile-tab-bar {
      display: flex;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 80;
      background: var(--navy);
      border-top: 1px solid rgba(39, 189, 190, 0.2);
      padding: 6px 8px calc(6px + var(--safe-bottom));
      justify-content: space-around;
      align-items: stretch;
      gap: 4px;
    }

    .tab-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
      padding: 6px 4px;
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.15s;
      flex: 1;
      min-height: 44px;
      justify-content: center;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    .tab-item:active { background: rgba(39, 189, 190, 0.1); }
    .tab-item .tab-icon {
      font-size: 20px;
      line-height: 1;
    }
    .tab-item .tab-label {
      font-size: 10px;
      color: var(--gray-400);
      letter-spacing: 0.2px;
    }
    .tab-item.active .tab-icon { color: var(--teal); }
    .tab-item.active .tab-label { color: var(--teal); }
  }

  @media (max-width: 480px) {
    .stat-row {
      grid-template-columns: repeat(3, 1fr);
    }
    header h1 { font-size: 13px; }
    .content-card h2 { font-size: 16px; gap: 8px; }
    .content-card h2 .section-icon { font-size: 18px; }
  }
</style>
</head>
<body>

<header>
  <h1><span>PROJECT 3</span> &nbsp;¬∑&nbsp; qmd Implementation Brief v3.5</h1>
  <div class="header-meta">
    <span>Jan 31, 2026</span>
    <span class="status-badge blocker">Architecture Decision Needed</span>
  </div>
</header>

<nav class="sidebar">
  <div class="sidebar-section">
    <h3>Quick Views</h3>
    <div class="preset-row" id="presets"></div>
  </div>
  <div class="sidebar-section">
    <h3>Sections</h3>
    <div id="nav-items"></div>
  </div>
  <div class="sidebar-section">
    <h3>Architecture Options</h3>
    <div id="arch-nav"></div>
  </div>
</nav>

<main class="main" id="main-content"></main>

<!-- Mobile Tab Bar -->
<nav class="mobile-tab-bar" id="mobile-tabs">
  <div class="tab-item active" onclick="mobileTab('overview')" data-tab="overview">
    <span class="tab-icon">‚óÜ</span>
    <span class="tab-label">Overview</span>
  </div>
  <div class="tab-item" onclick="mobileTab('qmd')" data-tab="qmd">
    <span class="tab-icon">‚åï</span>
    <span class="tab-label">qmd</span>
  </div>
  <div class="tab-item" onclick="mobileTab('decisions')" data-tab="decisions">
    <span class="tab-icon">‚ö°</span>
    <span class="tab-label">Decision</span>
  </div>
  <div class="tab-item" onclick="mobileTab('sessions')" data-tab="sessions">
    <span class="tab-icon">‚ó∑</span>
    <span class="tab-label">History</span>
  </div>
  <div class="tab-item" onclick="toggleSheet()" data-tab="sheet">
    <span class="tab-icon">‚ò∞</span>
    <span class="tab-label">All</span>
  </div>
</nav>

<!-- Slide-up Navigation Sheet -->
<div class="sheet-backdrop" id="sheet-backdrop" onclick="closeSheet()"></div>
<div class="nav-sheet" id="nav-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-section">
    <h3>Quick Views</h3>
    <div class="sheet-presets" id="sheet-presets"></div>
  </div>
  <div class="sheet-section">
    <h3>All Sections</h3>
    <div id="sheet-nav-items"></div>
  </div>
  <div class="sheet-section">
    <h3>Architecture Options</h3>
    <div id="sheet-arch-nav"></div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ
const state = {
  activeSection: 'overview',
  selectedArch: null,
  view: 'all',
  sheetOpen: false
};

// ‚îÄ‚îÄ‚îÄ Data ‚îÄ‚îÄ‚îÄ
const SECTIONS = [
  { id: 'overview', label: 'Project Overview', icon: '‚óÜ', tag: 'blocker', tagLabel: 'Blocked' },
  { id: 'workflow', label: 'Research Workflow', icon: '‚Üí', tag: 'done', tagLabel: 'Designed' },
  { id: 'vault', label: 'Vault & Content', icon: '‚ñ§', tag: 'done', tagLabel: '270 Books' },
  { id: 'splitting', label: 'Splitting Strategy', icon: '‚úÇ', tag: 'done', tagLabel: 'Tested' },
  { id: 'metadata', label: 'Metadata & Registry', icon: '‚¨°', tag: 'done', tagLabel: 'Finalized' },
  { id: 'scripts', label: 'Scripts & Tools', icon: '‚öô', tag: 'done', tagLabel: '6 Built' },
  { id: 'qmd', label: 'qmd Search Engine', icon: '‚åï', tag: 'blocker', tagLabel: 'Limitations' },
  { id: 'sessions', label: 'Session History', icon: '‚ó∑', tag: 'pending', tagLabel: '3 Sessions' },
  { id: 'decisions', label: 'Architecture Decision', icon: '‚ö°', tag: 'blocker', tagLabel: 'Blocking' },
  { id: 'next', label: 'What\u2019s Next', icon: '‚ñ∂', tag: 'blocked', tagLabel: 'Waiting' },
];

const PRESETS = [
  { id: 'all', label: 'Full Brief' },
  { id: 'status', label: 'Status Check' },
  { id: 'decision', label: 'Decision Focus' },
  { id: 'technical', label: 'Technical Deep Dive' },
];

const ARCH_OPTIONS = [
  { id: 'A', name: 'qmd Only', short: 'Workarounds for YAML/filtering', pros: 'No new tools', cons: 'No filtering, two file copies' },
  { id: 'B', name: 'qmd + ChromaDB', short: 'Two-tool setup: browse + research', pros: 'Full metadata filtering', cons: 'Two systems to maintain' },
  { id: 'C', name: 'ChromaDB Only', short: 'Replace qmd entirely', pros: 'Simplest long-term', cons: 'Lose hybrid search quality' },
  { id: 'D', name: 'SQLite + Vectors', short: 'Custom lightweight build', pros: 'Single file, full control', cons: 'More custom code to build' },
];

// Tabs that map to sections (for highlighting active mobile tab)
const TAB_SECTIONS = ['overview', 'qmd', 'decisions', 'sessions'];

// ‚îÄ‚îÄ‚îÄ Mobile Tab ‚îÄ‚îÄ‚îÄ
function mobileTab(sectionId) {
  closeSheet();
  selectSection(sectionId);
  updateMobileTabs();
}

function updateMobileTabs() {
  document.querySelectorAll('.tab-item').forEach(el => {
    const tab = el.dataset.tab;
    if (tab === 'sheet') {
      el.classList.toggle('active', state.sheetOpen);
    } else {
      el.classList.toggle('active', tab === state.activeSection);
    }
  });
}

// ‚îÄ‚îÄ‚îÄ Sheet ‚îÄ‚îÄ‚îÄ
function toggleSheet() {
  if (state.sheetOpen) {
    closeSheet();
  } else {
    openSheet();
  }
}

function openSheet() {
  state.sheetOpen = true;
  const backdrop = document.getElementById('sheet-backdrop');
  const sheet = document.getElementById('nav-sheet');
  backdrop.style.display = 'block';
  requestAnimationFrame(() => {
    backdrop.classList.add('visible');
    sheet.classList.add('open');
  });
  renderSheet();
  updateMobileTabs();
}

function closeSheet() {
  state.sheetOpen = false;
  const backdrop = document.getElementById('sheet-backdrop');
  const sheet = document.getElementById('nav-sheet');
  sheet.classList.remove('open');
  backdrop.classList.remove('visible');
  setTimeout(() => { backdrop.style.display = 'none'; }, 200);
  updateMobileTabs();
}

function renderSheet() {
  const presetsEl = document.getElementById('sheet-presets');
  presetsEl.innerHTML = PRESETS.map(p => `
    <button class="preset-btn ${state.view === p.id ? 'active' : ''}" onclick="sheetSetView('${p.id}')">${p.label}</button>
  `).join('');

  const navEl = document.getElementById('sheet-nav-items');
  navEl.innerHTML = SECTIONS.map(s => `
    <div class="sheet-item ${state.activeSection === s.id ? 'active' : ''}" onclick="sheetSelectSection('${s.id}')">
      <span class="icon">${s.icon}</span>
      <span class="label">${s.label}</span>
      <span class="tag tag-${s.tag}">${s.tagLabel}</span>
    </div>
  `).join('');

  const archEl = document.getElementById('sheet-arch-nav');
  archEl.innerHTML = ARCH_OPTIONS.map(a => `
    <div class="sheet-item ${state.selectedArch === a.id ? 'active' : ''}" onclick="sheetSelectArch('${a.id}')">
      <span class="icon" style="font-weight:700;">¬ß${a.id}</span>
      <span class="label">${a.name}</span>
    </div>
  `).join('');
}

function sheetSelectSection(id) {
  closeSheet();
  selectSection(id);
  updateMobileTabs();
}

function sheetSetView(id) {
  closeSheet();
  setView(id);
  updateMobileTabs();
}

function sheetSelectArch(id) {
  closeSheet();
  selectArch(id);
  updateMobileTabs();
}

// ‚îÄ‚îÄ‚îÄ Render Navigation (Desktop Sidebar) ‚îÄ‚îÄ‚îÄ
function renderNav() {
  const navEl = document.getElementById('nav-items');
  navEl.innerHTML = SECTIONS.map(s => `
    <div class="nav-item ${state.activeSection === s.id ? 'active' : ''}" onclick="selectSection('${s.id}')">
      <span class="icon">${s.icon}</span>
      <span class="label">${s.label}</span>
      <span class="tag tag-${s.tag}">${s.tagLabel}</span>
    </div>
  `).join('');

  const presetEl = document.getElementById('presets');
  presetEl.innerHTML = PRESETS.map(p => `
    <button class="preset-btn ${state.view === p.id ? 'active' : ''}" onclick="setView('${p.id}')">${p.label}</button>
  `).join('');

  const archEl = document.getElementById('arch-nav');
  archEl.innerHTML = ARCH_OPTIONS.map(a => `
    <div class="nav-item ${state.selectedArch === a.id ? 'active' : ''}" onclick="selectArch('${a.id}')">
      <span class="icon" style="font-weight:700;">¬ß${a.id}</span>
      <span class="label">${a.name}</span>
    </div>
  `).join('');
}

function selectSection(id) {
  state.activeSection = id;
  state.view = 'all';
  renderNav();
  renderContent();
  updateMobileTabs();
}

function selectArch(id) {
  state.selectedArch = state.selectedArch === id ? null : id;
  state.activeSection = 'decisions';
  state.view = 'all';
  renderNav();
  renderContent();
  updateMobileTabs();
}

function setView(id) {
  state.view = id;
  if (id === 'status') state.activeSection = 'overview';
  if (id === 'decision') state.activeSection = 'decisions';
  if (id === 'technical') state.activeSection = 'qmd';
  renderNav();
  renderContent();
  updateMobileTabs();
}

// ‚îÄ‚îÄ‚îÄ Content Renderers ‚îÄ‚îÄ‚îÄ
function renderContent() {
  const main = document.getElementById('main-content');

  if (state.view === 'status') {
    main.innerHTML = renderStatusView();
  } else if (state.view === 'decision') {
    main.innerHTML = renderDecisionView();
  } else if (state.view === 'technical') {
    main.innerHTML = renderTechnicalView();
  } else {
    main.innerHTML = renderSection(state.activeSection);
  }
  main.scrollTop = 0;
}

function renderSection(id) {
  const renderers = {
    overview: renderOverview,
    workflow: renderWorkflow,
    vault: renderVault,
    splitting: renderSplitting,
    metadata: renderMetadata,
    scripts: renderScripts,
    qmd: renderQmd,
    sessions: renderSessions,
    decisions: renderDecisionView,
    next: renderNext,
  };
  return (renderers[id] || renderOverview)();
}

function renderOverview() {
  return `
    <div class="content-card">
      <h2><span class="section-icon">‚óÜ</span> Project 3: qmd Implementation Brief</h2>
      <p class="subtitle">Build a local semantic search system for an Obsidian vault of book highlights, enabling natural language queries to support essay research for Substack.</p>

      <div class="stat-row">
        <div class="stat-card"><div class="value">270</div><div class="desc">Book Files</div></div>
        <div class="stat-card"><div class="value">2.09M</div><div class="desc">Total Words</div></div>
        <div class="stat-card"><div class="value">23,411</div><div class="desc">Highlights</div></div>
        <div class="stat-card"><div class="value gold">79</div><div class="desc">Favorites</div></div>
        <div class="stat-card"><div class="value">267</div><div class="desc">Books in Registry</div></div>
        <div class="stat-card"><div class="value red">1</div><div class="desc">Blocker</div></div>
      </div>

      <h3>Pipeline Status</h3>
      <div class="flow-diagram">
        <div class="flow-step"><div class="flow-node done">üìö</div><div class="flow-label">Readwise Sync</div></div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-step"><div class="flow-node done">üîç</div><div class="flow-label">Vault Audit</div></div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-step"><div class="flow-node done">üìã</div><div class="flow-label">Registry Built</div></div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-step"><div class="flow-node done">‚úÇÔ∏è</div><div class="flow-label">Split (5 test)</div></div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-step"><div class="flow-node done">‚ö°</div><div class="flow-label">qmd Tested</div></div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-step"><div class="flow-node current">üèóÔ∏è</div><div class="flow-label">Architecture Decision</div></div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-step"><div class="flow-node blocked">‚úÇÔ∏è</div><div class="flow-label">Full Split</div></div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-step"><div class="flow-node future">üìá</div><div class="flow-label">Full Index</div></div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-step"><div class="flow-node future">‚úçÔ∏è</div><div class="flow-label">Essay Workflow</div></div>
      </div>

      <h3>Project Context</h3>
      <p>Part of an 8-week research-to-publication system (Jan\u2013Feb 2026):</p>
      <ul>
        <li>Project 1 ‚úÖ \u2014 Claude Desktop mastery</li>
        <li>Project 2 ‚úÖ \u2014 Roam ‚Üí Obsidian migration (199 notes)</li>
        <li><strong>Project 3</strong> \u2014 qmd RAG system ‚Üê <em>Current, blocked</em></li>
        <li>Project 5 \u2014 Substack essays (depends on Project 3)</li>
      </ul>
    </div>`;
}

function renderWorkflow() {
  return `
    <div class="content-card">
      <h2><span class="section-icon">‚Üí</span> Research Workflow</h2>
      <p class="subtitle">The end-to-end pipeline from reading to publishing.</p>

      <div class="flow-diagram" style="flex-wrap: wrap; justify-content: center;">
        <div class="flow-step"><div class="flow-node done">üìñ</div><div class="flow-label">1. Sources<br><small style="color:var(--gray-400)">Readwise ‚Üí Obsidian</small></div></div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-step"><div class="flow-node done">‚úÇÔ∏è</div><div class="flow-label">2. Split & Tag<br><small style="color:var(--gray-400)">~800-word chunks + YAML</small></div></div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-step"><div class="flow-node current">üîç</div><div class="flow-label">3. Search<br><small style="color:var(--gray-400)">Natural language queries</small></div></div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-step"><div class="flow-node future">ü§ñ</div><div class="flow-label">4. Claude<br><small style="color:var(--gray-400)">Synthesize patterns</small></div></div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-step"><div class="flow-node future">‚úçÔ∏è</div><div class="flow-label">5. Substack<br><small style="color:var(--gray-400)">Shyam writes</small></div></div>
      </div>

      <h3>V1 Scope</h3>
      <table class="data-table">
        <tr><th>Included</th><th>Excluded</th></tr>
        <tr><td>‚úÖ Book highlights from Readwise</td><td>‚ùå Article highlights</td></tr>
        <tr><td>‚úÖ Book Registry with metadata</td><td>‚ùå Course notes</td></tr>
        <tr><td>‚úÖ Pre-split large files</td><td>‚ùå Meeting notes</td></tr>
        <tr><td>‚úÖ YAML frontmatter</td><td>‚ùå Newsletters</td></tr>
        <tr><td>‚úÖ Search + ongoing workflow</td><td>‚ùå PDFs</td></tr>
      </table>
    </div>`;
}

function renderVault() {
  return `
    <div class="content-card">
      <h2><span class="section-icon">‚ñ§</span> Vault & Content</h2>
      <p class="subtitle">Current state of the Obsidian vault and Readwise highlights.</p>

      <div class="stat-row">
        <div class="stat-card"><div class="value">572</div><div class="desc">Total Files</div></div>
        <div class="stat-card"><div class="value">373</div><div class="desc">Readwise Files</div></div>
        <div class="stat-card"><div class="value">199</div><div class="desc">Roam Import</div></div>
        <div class="stat-card"><div class="value red">154</div><div class="desc">Need Splitting</div></div>
      </div>

      <h3>Size Distribution</h3>
      <table class="data-table">
        <tr><th>Category</th><th>Criteria</th><th>Count</th><th>Action</th></tr>
        <tr><td>Small</td><td>&lt; 2,000 words</td><td>116</td><td>Copy as-is with YAML</td></tr>
        <tr><td>Large</td><td>2,000\u201330,000 words</td><td>137</td><td>Split into ~800-word parts</td></tr>
        <tr><td>Huge</td><td>&gt; 30,000 words</td><td>17</td><td>Split (many parts)</td></tr>
      </table>

      <h3>Notable Files</h3>
      <ul>
        <li><strong>Largest:</strong> The Price of Peace \u2014 68,223 words ‚Üí 102 parts</li>
        <li><strong>3 duplicate pairs</strong> from Readwise's <code>-2</code> splitting (Stalingrad, A Place of Greater Safety, The World of Yesterday)</li>
        <li><strong>38 files</strong> with nested bullets, <strong>6</strong> with \u201cLast, First\u201d author format</li>
      </ul>

      <h3>Folder Structure (Target)</h3>
      <pre>MyVault/
‚îú‚îÄ‚îÄ Books/                    ‚Üê qmd indexes this
‚îÇ   ‚îú‚îÄ‚îÄ {Book Name}/          ‚Üê split books
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ _Index.md
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ {Book} - N.md
‚îÇ   ‚îî‚îÄ‚îÄ {Small Book}.md      ‚Üê books &lt;2000 words
‚îú‚îÄ‚îÄ Readwise-Highlights/      ‚Üê source (Readwise syncs)
‚îú‚îÄ‚îÄ Readwise-Original/        ‚Üê archive of pre-split
‚îú‚îÄ‚îÄ Roam-Import/              ‚Üê NOT indexed in v1
‚îî‚îÄ‚îÄ _System/
    ‚îú‚îÄ‚îÄ Book-Metadata-Registry.yaml
    ‚îî‚îÄ‚îÄ needs-attention.md</pre>
    </div>`;
}

function renderSplitting() {
  return `
    <div class="content-card">
      <h2><span class="section-icon">‚úÇ</span> Splitting Strategy</h2>
      <p class="subtitle">How large Readwise files are pre-split for optimal qmd chunking.</p>

      <h3>The Problem</h3>
      <p>Some Readwise files are 25,000+ words (entire books). qmd's fixed 800-token chunking creates arbitrary, meaningless splits mid-highlight.</p>

      <h3>Splitting Rules</h3>
      <ol>
        <li>Files <strong>&lt; 2,000 words</strong> ‚Üí Don't split</li>
        <li>Files <strong>‚â• 2,000 words</strong> ‚Üí Split into ~800-word segments</li>
        <li><strong>Never</strong> split mid-highlight (always between bullet points)</li>
        <li>Each part gets full YAML metadata from Registry</li>
      </ol>

      <h3>File Naming Convention</h3>
      <pre>Small book (&lt;2000 words):
  The Short Book.md              (no number)

Large book (split):
  Books/
  ‚îî‚îÄ‚îÄ The Psychology of Money/
      ‚îú‚îÄ‚îÄ _Index.md
      ‚îú‚îÄ‚îÄ The Psychology of Money - 1.md
      ‚îú‚îÄ‚îÄ The Psychology of Money - 2.md
      ‚îî‚îÄ‚îÄ ...</pre>

      <h3>5-Book Test Results</h3>
      <table class="data-table">
        <tr><th>Book</th><th>Words</th><th>Result</th></tr>
        <tr><td>The 4-Hour Chef</td><td style="font-variant-numeric:tabular-nums">31</td><td>Single file (tiny)</td></tr>
        <tr><td>Game Changer</td><td style="font-variant-numeric:tabular-nums">652</td><td>Single file (small)</td></tr>
        <tr><td>Ivory Throne</td><td style="font-variant-numeric:tabular-nums">2,634</td><td>4 parts + Index</td></tr>
        <tr><td>The Indian Bourgeoisie</td><td style="font-variant-numeric:tabular-nums">10,402</td><td>14 parts + Index</td></tr>
        <tr><td>The Price of Peace</td><td style="font-variant-numeric:tabular-nums">68,223</td><td>102 parts + Index</td></tr>
      </table>
    </div>`;
}

function renderMetadata() {
  return `
    <div class="content-card">
      <h2><span class="section-icon">‚¨°</span> Metadata & Registry</h2>
      <p class="subtitle">Centralized book metadata used to tag all split files.</p>

      <div class="stat-row">
        <div class="stat-card"><div class="value">267</div><div class="desc">Books in Registry</div></div>
        <div class="stat-card"><div class="value">126</div><div class="desc">Fiction</div></div>
        <div class="stat-card"><div class="value">139</div><div class="desc">Nonfiction</div></div>
        <div class="stat-card"><div class="value gold">79</div><div class="desc">Favorites</div></div>
      </div>

      <h3>Registry Location</h3>
      <p><code>MyVault/_System/Book-Metadata-Registry.yaml</code></p>

      <h3>Registry Format</h3>
      <pre>The Psychology of Money:
  author: Morgan Housel
  genre: nonfiction
  book_tags: [finance, psychology, behavior]
  favorite: true</pre>

      <h3>Key Decisions</h3>
      <table class="data-table">
        <tr><th>Decision</th><th>Choice</th></tr>
        <tr><td>Genre granularity</td><td>Simple: <code>fiction</code> or <code>nonfiction</code></td></tr>
        <tr><td>Tag vocabulary</td><td>Controlled (Shyam's terms, ~20-30 words)</td></tr>
        <tr><td>Tag level</td><td>Book-level only (not per-highlight)</td></tr>
        <tr><td>Favorite marking</td><td>Manual only</td></tr>
        <tr><td>API source</td><td>Open Library only (Google Books removed)</td></tr>
      </table>

      <h3>YAML Schema (Split Files)</h3>
      <pre>---
title: "The Psychology of Money - 3"
parent_book: "The Psychology of Money"
author: "Morgan Housel"
part: 3
total_parts: 12
genre: nonfiction
book_tags: [finance, psychology, behavior]
favorite: true
source: readwise
split_date: 2026-01-28
word_count: 782
qmd_ready: true
---</pre>
    </div>`;
}

function renderScripts() {
  return `
    <div class="content-card">
      <h2><span class="section-icon">‚öô</span> Scripts & Tools</h2>
      <p class="subtitle">All 6 Python scripts in <code>~/Documents/Docs/Research-System/Scripts/</code></p>

      <table class="data-table">
        <tr><th>Script</th><th>Purpose</th><th>Status</th></tr>
        <tr>
          <td><code>audit_vault.py</code></td>
          <td>Analyze vault, identify large files, report stats</td>
          <td><span class="tag tag-done" style="font-size:11px">‚úÖ Run</span></td>
        </tr>
        <tr>
          <td><code>populate_book_registry.py</code></td>
          <td>Auto-populate Registry via Open Library API</td>
          <td><span class="tag tag-done" style="font-size:11px">‚úÖ Refactored</span></td>
        </tr>
        <tr>
          <td><code>split_readwise.py</code></td>
          <td>Split large files, apply YAML from Registry</td>
          <td><span class="tag tag-done" style="font-size:11px">‚úÖ Tested</span></td>
        </tr>
        <tr>
          <td><code>check_for_updates.py</code></td>
          <td>Detect new books since last run</td>
          <td><span class="tag tag-done" style="font-size:11px">‚úÖ Built</span></td>
        </tr>
        <tr>
          <td><code>process_updates.py</code></td>
          <td>One-command wrapper for ongoing workflow</td>
          <td><span class="tag tag-done" style="font-size:11px">‚úÖ Built</span></td>
        </tr>
      </table>

      <h3>qmd Commands Reference</h3>
      <pre># Installation
bun install -g https://github.com/tobi/qmd

# Collection setup
qmd collection add &lt;path&gt; --name &lt;name&gt;
qmd context add qmd://&lt;name&gt; "Description"

# Indexing
qmd embed              # Generate embeddings
qmd embed -f           # Force re-embed

# Search modes
qmd search "keywords"  # BM25 only (fastest)
qmd vsearch "concept"  # Vector only (semantic)
qmd query "question"   # Hybrid + rerank (best)</pre>

      <h3>Dependencies</h3>
      <p>Python: <code>requests</code>, <code>pyyaml</code> (system pip, no virtualenv)</p>
      <p>qmd: installed at <code>~/.bun/bin/qmd</code> (not on PATH)</p>
    </div>`;
}

function renderQmd() {
  return `
    <div class="content-card">
      <h2><span class="section-icon">‚åï</span> qmd Search Engine</h2>
      <p class="subtitle">Tobi L\u00fctke's local hybrid search \u2014 tested and found wanting for the full workflow.</p>

      <h3>What qmd Does Well</h3>
      <ul>
        <li><strong>BM25</strong> full-text search (keyword matching)</li>
        <li><strong>Vector semantic search</strong> (meaning matching)</li>
        <li><strong>LLM re-ranking</strong> (relevance scoring)</li>
        <li><strong>Query expansion</strong> (rewrites queries for better recall)</li>
      </ul>

      <div class="stat-row">
        <div class="stat-card"><div class="value">15</div><div class="desc">Books Tested</div></div>
        <div class="stat-card"><div class="value">269</div><div class="desc">Files Indexed</div></div>
        <div class="stat-card"><div class="value">543</div><div class="desc">Embedded Chunks</div></div>
        <div class="stat-card"><div class="value">93%</div><div class="desc">Top Match Score</div></div>
      </div>

      <h3 style="color:#fc8181">‚ö† Discovered Limitations</h3>

      <div style="background:var(--red-dim); border:1px solid rgba(229,62,62,0.3); border-radius:var(--radius); padding:16px; margin:12px 0;">
        <h4 style="color:#fc8181; font-size:13px; margin-bottom:8px;">Limitation 1: Chunking ignores document structure</h4>
        <p style="font-size:12px; color:var(--gray-200); line-height:1.6;">qmd's 800-token chunker splits at token boundaries, not highlight boundaries. YAML frontmatter (~80-100 tokens) eats into the budget.</p>
      </div>

      <div style="background:var(--red-dim); border:1px solid rgba(229,62,62,0.3); border-radius:var(--radius); padding:16px; margin:12px 0;">
        <h4 style="color:#fc8181; font-size:13px; margin-bottom:8px;">Limitation 2: No metadata filtering (BLOCKER)</h4>
        <p style="font-size:12px; color:var(--gray-200); line-height:1.6;">Cannot filter by genre, tags, favorites, or any YAML field. Only filter is <code>-c</code> (collection name). Confirmed by reviewing CLI help and GitHub repo.</p>
      </div>

      <div style="background:var(--red-dim); border:1px solid rgba(229,62,62,0.3); border-radius:var(--radius); padding:16px; margin:12px 0;">
        <h4 style="color:#fc8181; font-size:13px; margin-bottom:8px;">Limitation 3: YAML pollutes search results (BLOCKER)</h4>
        <p style="font-size:12px; color:var(--gray-200); line-height:1.6;">YAML keywords compete with actual highlights. Query for \u201cindia climate story\u201d returned YAML block at 92% instead of highlight content.</p>
      </div>

      <div style="background:rgba(160,174,192,0.08); border:1px solid rgba(160,174,192,0.15); border-radius:var(--radius); padding:16px; margin:12px 0;">
        <h4 style="color:var(--gray-300); font-size:13px; margin-bottom:8px;">Limitation 4: _Index.md files appear as noise</h4>
        <p style="font-size:12px; color:var(--gray-400); line-height:1.6;">Index files surface in results. Low impact \u2014 they score low \u2014 but add clutter.</p>
      </div>
    </div>`;
}

function renderSessions() {
  return `
    <div class="content-card">
      <h2><span class="section-icon">‚ó∑</span> Session History</h2>
      <p class="subtitle">Three working sessions across January 30\u201331, 2026.</p>

      <div class="timeline">
        <div class="timeline-item s1">
          <h4>Session 1 \u2014 Jan 30 (Morning)</h4>
          <p>Vault audit ‚úÖ \u2022 bun + qmd installed ‚úÖ \u2022 All 6 Python scripts built ‚úÖ \u2022 Dependencies installed ‚úÖ</p>
          <p style="margin-top:6px;">Key finding: 270 book files, 154 need splitting, 17 are huge (&gt;30K words).</p>
        </div>
        <div class="timeline-item s2">
          <h4>Session 2 \u2014 Jan 30 (Afternoon)</h4>
          <p>Registry populated (267 books, OL-only) ‚úÖ \u2022 User reviewed CSV ‚úÖ \u2022 YAML finalized (126 fiction, 139 nonfiction, 79 favorites) ‚úÖ \u2022 5-book split test ‚úÖ</p>
          <p style="margin-top:6px;">Google Books API removed (quota exhausted). <code>populate_book_registry.py</code> significantly refactored.</p>
        </div>
        <div class="timeline-item s3">
          <h4>Session 3 \u2014 Jan 31</h4>
          <p>qmd collection set up ‚úÖ \u2022 5-book test (search quality good, 93% scores) ‚úÖ \u2022 Expanded to 15 books (269 files, 543 chunks) ‚úÖ \u2022 <strong style="color:#fc8181">Limitations discovered ‚ö†Ô∏è</strong></p>
          <p style="margin-top:6px;">YAML pollution + no metadata filtering = <strong>architecture decision needed</strong> before proceeding.</p>
        </div>
      </div>
    </div>`;
}

function renderDecisionView() {
  const selected = state.selectedArch ? ARCH_OPTIONS.find(a => a.id === state.selectedArch) : null;
  return `
    <div class="content-card">
      <h2><span class="section-icon">‚ö°</span> Architecture Decision</h2>
      <p class="subtitle">qmd tested and found limited. Choose an architecture to unblock the project. Click an option below.</p>

      <h3>The Core Problem</h3>
      <p>The essay workflow needs: <strong>(1)</strong> clean highlight text returned, <strong>(2)</strong> metadata filtering by genre/tags/favorites, <strong>(3)</strong> structured output for Claude. qmd cannot do #2 or #3, and #1 is unreliable.</p>

      <div class="arch-grid">
        ${ARCH_OPTIONS.map(a => `
          <div class="arch-card ${state.selectedArch === a.id ? 'selected' : ''}" onclick="selectArch('${a.id}')">
            <h4>Option ${a.id}: ${a.name}</h4>
            <p>${a.short}</p>
            <div class="pros">‚úì ${a.pros}</div>
            <div class="cons">‚úó ${a.cons}</div>
          </div>
        `).join('')}
      </div>

      ${selected ? `
      <div style="background:var(--teal-dim); border:1px solid var(--teal-mid); border-radius:var(--radius); padding:20px; margin-top:16px;">
        <h3 style="margin-top:0; color:var(--teal);">Selected: Option ${selected.id} \u2014 ${selected.name}</h3>
        ${renderArchDetail(selected.id)}
      </div>` : `
      <p style="color:var(--gray-400); font-style:italic; margin-top:16px;">Click an option above to see full details.</p>
      `}
    </div>`;
}

function renderArchDetail(id) {
  const details = {
    A: `<ul>
      <li>Strip YAML from qmd-indexed copies (keep full YAML in Obsidian copies)</li>
      <li>Accept lack of metadata filtering; use topical queries instead</li>
      <li>Use <code>qmd get</code> to retrieve full files after <code>query</code> finds them</li>
      <li>Two copies of every file (Obsidian + qmd-clean)</li>
    </ul>`,
    B: `<ul>
      <li>Keep qmd for quick terminal browsing (\u201cwhich book mentions X?\u201d)</li>
      <li>Add ChromaDB for essay research workflow</li>
      <li>Chroma stores each highlight individually with structured metadata</li>
      <li>Supports <code>where</code> filters: <code>{"genre": "nonfiction", "favorite": true}</code></li>
      <li>Need embedding model (Voyage AI or local)</li>
    </ul>`,
    C: `<ul>
      <li>Drop qmd entirely, build Chroma-based search</li>
      <li>One system, structured metadata, clean output</li>
      <li>Lose qmd's hybrid search (BM25 + vector + reranking)</li>
      <li>Simplest long-term maintenance</li>
    </ul>`,
    D: `<ul>
      <li>Store highlights in SQLite with metadata columns</li>
      <li>Add vector search via sqlite-vss or similar</li>
      <li>Full SQL filtering on any field</li>
      <li>Single file, full control \u2014 but more custom code</li>
    </ul>`,
  };
  return details[id] || '';
}

function renderNext() {
  return `
    <div class="content-card">
      <h2><span class="section-icon">‚ñ∂</span> What\u2019s Next</h2>
      <p class="subtitle">Blocked on architecture decision. Everything downstream depends on it.</p>

      <h3>Immediate Next Steps</h3>
      <ol>
        <li><strong style="color:var(--gold);">Decide on architecture</strong> (Options A\u2013D). This is a blocking decision.</li>
        <li>If keeping qmd: strip YAML from indexed copies to fix frontmatter pollution.</li>
        <li>If adding Chroma: build indexing script for individual highlights with metadata.</li>
        <li>Full split of remaining ~252 books.</li>
        <li>Full indexing.</li>
        <li>Validation searches.</li>
      </ol>

      <h3>Success Criteria</h3>
      <div>
        <div class="checklist-item pending"><span class="check"></span> All book highlights indexed</div>
        <div class="checklist-item pending"><span class="check"></span> Search returns relevant results</div>
        <div class="checklist-item done"><span class="check">‚úì</span> Each file has complete YAML metadata</div>
        <div class="checklist-item pending"><span class="check"></span> Ongoing workflow documented and working</div>
      </div>

      <h3>Quality Bar</h3>
      <div>
        <div class="checklist-item pending"><span class="check"></span> <code>qmd query "leadership frameworks"</code> ‚Üí relevant chapters</div>
        <div class="checklist-item pending"><span class="check"></span> <code>qmd query "Lenin critique of banks"</code> ‚Üí Bankers and Bolsheviks</div>
        <div class="checklist-item pending"><span class="check"></span> Results show clear titles (not \u201cChunk 23\u201d)</div>
        <div class="checklist-item done"><span class="check">‚úì</span> No highlight split mid-thought</div>
      </div>
    </div>`;
}

function renderStatusView() {
  return renderOverview() + renderSessions();
}

function renderTechnicalView() {
  return renderQmd() + renderSplitting();
}

// ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ
renderNav();
renderContent();
updateMobileTabs();
</script>
</body>
</html>
